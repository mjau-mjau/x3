/* www.photo.gallery X3.33.1 / x3.cart.min.js / 2024-08-29 */
var cart=function(){var e=!1,a={},r=!1,o={},s={},cart=s,c=!1,n={},l={},d=x3_settings.plugins.cart,u=!1,m=!1,p=!1;function f(t){if(popupob.is_open&&popupob.mygallery)return popupob.pswp.classList.contains("x3-cart-popup")?popupob.mygallery.close():void(t&&$(".popup-cart-button-checked").removeClass("popup-cart-button-checked"))}function v(t){var e="/content/";return t.slice(t.indexOf(e)+9)}function h(t){var e=d.show_cart;if(["first_empty","first_page_empty"].indexOf(e)>-1&&Object.keys(cart).length)u=m=!0;else if(!("none"===e||"first"===e&&u||"first_empty"===e&&u||"first_page"===e&&m||"first_page_empty"===e&&m))return u=m=!0,!0}function x(t,e,cart){e&&(t?e.insertAdjacentHTML("afterbegin",'<svg viewBox="0 0 18 18" class="svg-preloader svg-preloader-active"><circle cx="9" cy="9" r="8" pathLength="100" class="svg-preloader-circle"></circle></svg>'):e.firstElementChild.remove()),cart&&n.cart.classList.toggle("x3-cart-is-downloading",t),document.documentElement.classList.toggle("x3-is-downloading",t)}function b(t,e,r,o){if(!t.length)return alert(l[o||"no-images-selected"]);var s=r||document.querySelector('[data-action="download-'+e+'"]');x(!0,s,"cart"===e);var c=t[0].split("/").slice(0,-1),n=c.join("/"),u=c.pop(),m="cart"===e&&t.some((function(t){return n!==t.split("/").slice(0,-1).join("/")})),p=("cart"!==e||!m&&x3_settings.file_path===n)&&t.length===Object.keys(a).length,g=(m?l["download-filename"]:u)+(p?"":"["+t.length+"]."+Math.round(Date.now()/1e3)),f=new JSZip,h=f.folder(g);t.forEach((function(t){h.file(m&&d.download_include_paths?v(t):t.split("/").pop(),fetch(t).then((function(t){return 200===t.status||0===t.status?Promise.resolve(t.blob()):Promise.reject(new Error(t.statusText))})),{binary:!0})})),f.generateAsync({type:"blob"}).then((function(t){x(!1,s,"cart"===e),saveAs(t,g+".zip"),d.success_empty_cart&&"cart"===e&&C(),d.success_close_cart&&"cart"===e&&j(!1)}),(function(t){x(!1,s,"cart"===e),alert("Error!")}))}function L(t,e,a){if(!a)return t.style.removeProperty(e);t.style.setProperty(e,'"'+a+'"')}function y(){return Object.keys(a).filter((function(t){return!!cart[t]}))}function _(t){if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){return}}function H(t){var e="x3:cart"+(d.page_unique?":"+x3_settings.file_path:"");if(!t.length)return localStorage.removeItem(e);localStorage.setItem(e,JSON.stringify(t))}function V(){x3_tests.local_storage&&H(Object.keys(cart))}function k(){var t=Object.keys(cart).length;document.documentElement.classList.toggle("x3-cart-is-empty",!t),L(document.documentElement,"--x3-cart-count",t);var e=document.getElementsByClassName("x3-cart-gallery-buttons")[0];if(e){e.classList.toggle("cart-empty",!t);var r=y().length;L(e,"--selected-count",r),e.classList.toggle("selected-empty",!r),e.classList.toggle("selected-all",r===Object.keys(a).length)}}function w(t){n.items.insertAdjacentHTML("afterbegin",function(t){var e=t.split("/"),r=e.pop(),o=e.join("/"),s=o.replace("/content/","/")+"/",c=v(o),n=a[t];return'<a href="'+t+'" target="_blank" class="x3-cart-item" data-action="popup"'+(n?' data-width="'+n.dataset.width+'" data-height="'+n.dataset.height+'"':"")+' data-popup-title="<strong>'+r+"</strong><small>"+c+'</small>"><img class="x3-cart-image" src="'+yt(t,100,"1.1")+'" alt="'+r+'" data-crop="true"><div class="x3-cart-text"><span class="x3-cart-text-name">'+r+'</span><span class="x3-cart-text-path" data-action="goto-page" data-path="'+s+'">'+c+'</span></div><svg class="x3-cart-remove" data-action="remove" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg></a>'}(t.replace(/"/g,"&quot;"))),cart[t]=n.items.firstElementChild}function E(t){cart[t].remove(),delete cart[t]}function M(t,e){return e&&d.limit&&Object.keys(cart).length>=d.limit?(alert(l["is-full"]),!1):(A(t,e),V(),k(),!0)}function A(t,e){if(t&&!!e!=!!cart[t])return e?(w(t),"name"===d.sort&&Object.keys(cart).sort(((t,e)=>t>e?1:-1)).forEach((t=>n.items.appendChild(cart[t])))):E(t),!0}function C(){var t=Object.keys(cart);t.length&&(t.forEach((function(t){E(t);var e=a[t];e&&e.classList.remove("x3-cart-item-checked")})),V(),k(),f(!0))}function j(t){if(e!=t&&((e=t)&&St(),document.documentElement.classList.toggle("x3-cart-is-open",t),popupob.is_open&&popupob.mygallery&&matchMedia("(min-width: 1025px)").matches&&popupob.mygallery.updateSize(!0),e||setTimeout(S,300),x3_tests.local_storage))return t?void localStorage.setItem("x3:cart_is_open",1):localStorage.removeItem("x3:cart_is_open")}function O(){var r,o,s;Z||(Z=!0,document.documentElement.classList.add("x3-cart-is-empty"),document.body.insertAdjacentHTML("beforeend",'<div class="x3-cart x3-cart-layout-'+(x3_tests.local_storage&&localStorage.getItem("x3:cart:layout")||"list")+'" data-action="close" data-popup-container data-popup-history="false" data-popup-main-class="x3-cart-popup"><div class="x3-cart-sidebar"><header class="x3-cart-header"><div class="x3-cart-title"></div><span class="x3-cart-button x3-cart-toggle-layout" data-action="layout"><svg viewBox="0 0 24 24"><path class="x3-cart-path-grid" d="M3 11H11V3H3M5 5H9V9H5M13 21H21V13H13M15 15H19V19H15M3 21H11V13H3M5 15H9V19H5M13 3V11H21V3M19 9H15V5H19Z" /><path class="x3-cart-path-list" d="M7,5H21V7H7V5M7,13V11H21V13H7M4,4.5A1.5,1.5 0 0,1 5.5,6A1.5,1.5 0 0,1 4,7.5A1.5,1.5 0 0,1 2.5,6A1.5,1.5 0 0,1 4,4.5M4,10.5A1.5,1.5 0 0,1 5.5,12A1.5,1.5 0 0,1 4,13.5A1.5,1.5 0 0,1 2.5,12A1.5,1.5 0 0,1 4,10.5M7,19V17H21V19H7M4,16.5A1.5,1.5 0 0,1 5.5,18A1.5,1.5 0 0,1 4,19.5A1.5,1.5 0 0,1 2.5,18A1.5,1.5 0 0,1 4,16.5Z" /></svg></span><span class="x3-cart-button x3-cart-empty" data-action="empty"><svg viewBox="0 0 24 24"><path d="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z" /></svg></span><span class="x3-cart-button x3-cart-close" data-action="close"><svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg></span></header><div class="x3-cart-items"></div>        <form class="x3-cart-order-form" novalidate><svg class="x3-cart-order-form-close" data-action="order-form-close" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg><input type="submit" hidden><div class="x3-cart-order-form-custom"></div></form><div class="x3-cart-loading"><svg viewBox="0 0 18 18" class="svg-preloader svg-preloader-active"><circle cx="9" cy="9" r="8" pathLength="100" class="svg-preloader-circle"></svg></div><div class="x3-cart-success"></div>            <footer class="x3-cart-footer"><button class="button x3-cart-footer-button" data-action="custom" tabindex="-1"></button><button class="button x3-cart-footer-button x3-download-button" data-action="download" tabindex="-1"></button><button class="button x3-cart-footer-button" data-action="order" tabindex="-1"></button></footer></div>'),n.cart=document.body.lastElementChild,n.sidebar=n.cart.firstElementChild,n.items=n.sidebar.children[1],n.form=n.sidebar.children[2],n.form_custom=n.form.lastElementChild,n.footer=n.sidebar.lastElementChild,n.$pb=ee("cart",!0),n.$pb.addClass("x3-cart-button-count").on("click",(function(){j(!0)})),r={"is-full":"Cart is full. Please remove some items to add more.","no-images-selected":"No images selected!","no-images-in-cart":"No items in cart!","download-filename":"download","layout-button":"Layout","empty-button":"Empty cart","close-button":"Close"},o=getComputedStyle(n.cart),Object.keys(r).forEach((function(t){var e=o.getPropertyValue("--x3-cart-text-"+t);e&&(r[t]=e.replace(/["']/g,"").trim())})),t.assign(l,r),D(n.sidebar.getElementsByClassName("x3-cart-button")).forEach((function(t){t.title=l[t.dataset.action+"-button"]})),n.form.addEventListener("submit",(function(t){t.preventDefault();var e=n.footer.getElementsByClassName("x3-cart-footer-button-active")[0];e&&e.click()})),(s=document.getElementsByClassName("menu-cart-toggle")[0])&&(s.classList.add("menu-cart-toggle-active"),s.firstElementChild.classList.add("menu-cart-toggle-a"),s.firstElementChild.addEventListener("click",(function(t){t.preventDefault(),t.stopImmediatePropagation(),j(!e)}))),window.addEventListener("popstate",(function(t){j(!1)})),n.cart.addEventListener("click",(function(t){var r=t.target.dataset.action;if("layout"===r){var o=n.cart.classList.toggle("x3-cart-layout-grid");n.cart.classList.toggle("x3-cart-layout-list"),x3_tests.local_storage&&localStorage.setItem("x3:cart:layout",o?"grid":"list")}else if("empty"===r)C();else if("order-form-close"===r)S();else if("close"===r)j(!1);else if("remove"===r){t.stopImmediatePropagation(),t.preventDefault();var s=t.target.parentElement.getAttribute("href");!function(t,e){var r=a[t];r&&r.classList.toggle("x3-cart-item-checked",!!e)}(s),M(s,!1),f(popupob.is_open&&popupob.mygallery.currItem.src===s)}else if("goto-page"===r)popupob.is_open&&popupob.mygallery&&popupob.mygallery.close(),e&&j(!1),$.pronto("navto",t,t.target,t.target.dataset.path,t.target.dataset.path);else if("download"===r){if(d.download_order_form)return B(t,(function(){b(Object.keys(cart),"cart")}));b(Object.keys(cart),"cart")}else"order"===r?B(t):"custom"===r?"function"==typeof cart_custom_click&&cart_custom_click(cart,a,n,d):e&&!matchMedia("(min-width: 1025px)").matches&&t.target.closest(".x3-cart-item")&&j(!1)})))}function S(){n.cart.classList.remove("x3-cart-show-order-form");var t=n.footer.getElementsByClassName("x3-cart-footer-button-active")[0];t&&(t.classList.remove("x3-cart-footer-button-active"),t.tabIndex=-1)}function B(e,a){var r=d.order_form&&d.order_form_html||!1;if(r){if(!n.cart.classList.contains("x3-cart-show-order-form")){if(r!==p){n.form_custom.innerHTML=p=r;var o=!(x3_tests.legacy_ie||!x3_tests.local_storage)&&localStorage.getItem("x3:cart:form");if(o){var s=Object.fromEntries(new URLSearchParams(o));D(n.form.getElementsByTagName("input")).forEach((function(t){var e=!(!t.name||""!==t.value||"hidden"===t.type||"false"===t.dataset.localstorage)&&s[t.name];e&&(t.value=e)}))}var c=n.form_custom.getElementsByTagName("textarea");c.length&&q("autosize",(function(t){t&&autosize($(c))}))}e&&e.target.classList.add("x3-cart-footer-button-active"),e&&(e.target.tabIndex=0),n.cart.classList.add("x3-cart-show-order-form");var l=n.form.querySelectorAll("input, textarea")[0];return void(l&&l.focus())}var u=!1,m=!0;if(D(n.form.querySelectorAll("input, select, textarea")).forEach((function(t){u||t.checkValidity()||(u=t),m&&t.value&&-1===["range","hidden","checkbox","button","radio","reset","search","submit"].indexOf(t.type)&&(m=!1)})),u)return m?S():(g($(n.form),"x3-cart-order-form-invalid",3e3),void u.scrollIntoView({behavior:"smooth",block:"center"}))}var f={},v=$(n.form);r&&v.serializeArray().forEach((function(t){f[t.name]=t.value})),t.assign(f,{action:"email",honey1:"",honey2:"alpaca",page:encodeURIComponent(location.href),cart:Object.keys(cart),cart_website:x3_tests.website,cart_output:d.cart_output});var h=f.name||f.email;if(f.template_subject||(f.template_subject="%domain% | New order "+(h?"from "+h:Math.round(Date.now()/1e3))),f.template||(f.template="New order"+(f.name?" from %name%":"")+(f.email?" [%email%]":"")+"."),x3_tests.local_storage){var x=v.serialize();x&&localStorage.setItem("x3:cart:form",x)}S(),n.cart.classList.add("x3-cart-is-ordering"),$.post(x3_settings.path+"/app/"+atob("eDMuYXBpLnBocA=="),f).done((function(t){var e=t&&t.success;if(e&&a)return a();var r="x3-cart-order-"+(e?"success":"fail");n.cart.classList.add("x3-cart-show-success",r),setTimeout((function(){e&&d.success_empty_cart&&C(),e&&d.success_close_cart&&j(!1),n.cart.classList.remove("x3-cart-show-success",r)}),3e3)})).fail((function(){g($(n.cart),"x3-cart-show-success x3-cart-order-fail",3e3)})).always((function(){e.target.classList.remove("x3-cart-footer-button-active"),n.cart.classList.remove("x3-cart-is-ordering")}))}return{init:function(){if(d.enabled||Z){var t=!!d.enabled&&document.querySelector(".gallery.images"),u=t?t.getElementsByClassName("item"):[],p=!!u.length&&D(u),f=!c&&!d.page_unique&&function(){c=!0;var t=!!x3_tests.local_storage&&_(localStorage.getItem("x3:cart"));if(t)return t.every((function(t,i){return!(d.limit&&i>=d.limit)&&(s[t]=!1,!0)})),$.post(x3_settings.path+"/app/x3.api.php",{action:"cart_items",items:t}).done((function(e){var r=_(e);r&&r.length&&(H(t.filter((function(t){return-1===r.indexOf(t)}))),r.forEach((function(t){cart===s&&s[t]&&s[t].remove(),s.hasOwnProperty(t)&&delete s[t],a[t]&&a[t].classList.remove("x3-cart-item-checked")})),k())})),!0}();if(Z)Object.keys(a).forEach((function(t){delete a[t]})),(d.page_unique||cart!==s)&&Object.keys(cart).forEach((function(t){cart[t].remove()}));else{if(!p.length&&!f)return;O(),localStorage.getItem("x3:cart_is_open")&&setTimeout((function(){!v&&Object.keys(cart).length&&j(!0)}),100)}var v=!p.length&&(d.hide_cart||d.page_unique);if(document.documentElement.classList.toggle("x3-cart-is-hidden",v),!v){if(d.page_unique||cart!==s||f){d.page_unique&&!o[x3_settings.file_path]&&(o[x3_settings.file_path]=(x={},L=!!x3_tests.local_storage&&_(localStorage.getItem("x3:cart:"+x3_settings.file_path)),E=0,L&&p.every((function(t){var e=t.dataset.image;return!(L.includes(e)&&(x[e]=t,E++,d.limit&&E>=d.limit))})),x)),cart=d.page_unique?o[x3_settings.file_path]:s;let t=Object.keys(cart);"name"===d.sort&&t.sort(((t,e)=>t>e?-1:1)),t.forEach(w),k()}var x,L,E;if(d.cart_download&&q("jszip"),["order","download","custom"].forEach((function(t){n.cart.classList.toggle("x3-cart-is-"+t,!!d["cart_"+t])})),p.length){d.gallery_buttons&&d.gallery_button_items.indexOf("download")>-1&&q("jszip"),m=!1,(r=d.select_mode||!!(d.gallery_buttons&&d.gallery_button_items.indexOf("select-mode")>-1)&&r)&&t.classList.add("x3-cart-gallery-select-mode"),d.checkbox&&d.checkbox_hover&&t.classList.add("x3-cart-gallery-checkbox-hover");var S=0;p.forEach((function(t){var e=t.dataset.image;if(!!cart[e]&&(t.classList.add("x3-cart-item-checked"),S++),d.checkbox){var r=t.querySelector(".image-container");r&&r.insertAdjacentHTML("beforeend",'<span class="x3-cart-checkbox" data-action="toggle-cart-item"></span>')}a[e]=t})),[!(!d.gallery_buttons||!d.gallery_button_items)&&function(){var e="",a={"select-mode":'<path class="checkbox-marked-outline" d="M19,19H5V5H15V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V11H19M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z" /><path class="checkbox-blank-outline" d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z" />',"select-all":'<path class="checkbox-multiple-marked" d="M20,16V10H22V16A2,2 0 0,1 20,18H8C6.89,18 6,17.1 6,16V4C6,2.89 6.89,2 8,2H16V4H8V16H20M10.91,7.08L14,10.17L20.59,3.58L22,5L14,13L9.5,8.5L10.91,7.08M16,20V22H4A2,2 0 0,1 2,20V7H4V20H16Z" /><path class="checkbox-multiple-blank" d="M20,16V4H8V16H20M22,16A2,2 0 0,1 20,18H8C6.89,18 6,17.1 6,16V4C6,2.89 6.89,2 8,2H20A2,2 0 0,1 22,4V16M16,20V22H4A2,2 0 0,1 2,20V7H4V20H16Z" />',"download-all":'<path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" />',"download-selected":'<path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" />',"download-cart":'<path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" />',cart:'<path d="M22 9H17.21L12.83 2.44C12.64 2.16 12.32 2 12 2S11.36 2.16 11.17 2.45L6.79 9H2C1.45 9 1 9.45 1 10C1 10.09 1 10.18 1.04 10.27L3.58 19.54C3.81 20.38 4.58 21 5.5 21H18.5C19.42 21 20.19 20.38 20.43 19.54L22.97 10.27L23 10C23 9.45 22.55 9 22 9M12 4.8L14.8 9H9.2L12 4.8M18.5 19L5.5 19L3.31 11H20.7L18.5 19M12 13C10.9 13 10 13.9 10 15S10.9 17 12 17 14 16.1 14 15 13.1 13 12 13Z" />',"empty-cart":'<path d="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z" />'};if(d.gallery_button_items.split(",").forEach((function(t){e+='<button class="x3-cart-gallery-button'+(0===t.indexOf("download")?" x3-download-button":"")+'" data-action="'+t+'"><svg class="x3-cart-gallery-button-svg" viewBox="0 0 24 24">'+a[t]+"</svg></button>"})),e)return t.insertAdjacentHTML("afterbegin",'<div class="x3-cart-gallery-buttons'+(S?S===p.length?" selected-all":"":" selected-empty")+(Object.keys(cart).length?"":" cart-empty")+'" style="--items-count:\''+p.length+"'"+(S?";--selected-count:'"+S+"'":"")+'">'+e+"</div>"),t.firstElementChild}(),document.getElementsByClassName("context")[0]].forEach((function(o){o&&o.addEventListener("click",(function(o){!function(t,o){var s=t.target.dataset.action;if(s)if(t.preventDefault(),"select-mode"===s)r=!r,o.classList.toggle("x3-cart-gallery-select-mode",r);else if("select-all"===s){var c=Object.keys(a),u=!c.every((function(t){return!!cart[t]}));if(u&&d.limit&&Object.keys(cart).length+c.length-y().length>d.limit)return alert(l["is-full"]);var m=h()&&u;if(c.reverse().forEach((function(t){A(t,u)&&a[t].classList.toggle("x3-cart-item-checked",u)})),V(),k(),u&&(n.items.scrollTop=0),m)return j(!0);g(n.$pb,"pulse",300)}else"download-all"===s?b(Object.keys(a),"all",t.target):"download-selected"===s?b(y(),"selected",t.target,"no-images-selected"):"download-cart"===s?b(Object.keys(cart),"cart",t.target,"no-images-in-cart"):"cart"===s?j(!e):"empty-cart"===s&&C()}(o,t)}))})),t.addEventListener("click",(function(t){var e=!(!r&&"toggle-cart-item"!==t.target.dataset.action)&&t.target.closest(".item");if(e){t.preventDefault(),t.stopImmediatePropagation();var a=!e.classList.contains("x3-cart-item-checked"),o=h()&&a;if(M(e.dataset.image,a)){if(e.classList.toggle("x3-cart-item-checked"),a&&(n.items.scrollTop=0),o)return j(!0);g(n.$pb,"pulse",300)}}}))}}}},in_cart:function(t){return!!cart[t]},toggle_item:function(t,e){var r=a[t],o=h()&&e;if(r&&M(t,e))return r.classList.toggle("x3-cart-item-checked"),e&&(n.items.scrollTop=0),o?j(!0):(g(n.$pb,"pulse",300),!0)}}}();